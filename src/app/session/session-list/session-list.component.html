<div class="example-container mat-elevation-z8">
  <cluedo-session-new></cluedo-session-new>
  <div class="example-header">
    <mat-form-field>
      <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
    </mat-form-field>
  </div>

  <mat-table #table [dataSource]="dataSource">
    <ng-container matColumnDef="sessionName">
      <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
      <mat-cell *matCellDef="let element">
        {{element.sessionName}}
        <mat-icon *ngIf="isDirectorOfGame(element._links)">supervisor_account</mat-icon>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="players">
      <mat-header-cell *matHeaderCellDef> Players </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <mat-chip *ngFor="let player of element._links.players; let index = index"
          [routerLink]="player.href" [selected]="element._links.turn && element.activePlayer == element.players[index]">
          {{ player.name }}
          <mat-icon *ngIf="isDirectorOfGame(element._links) && player.href != element._links.admin.href"
            matChipRemove (click)="kickOutOfSession(element._links.self.href, player.href)">cancel</mat-icon>
        </mat-chip>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="_links">
      <mat-header-cell *matHeaderCellDef> Hyperlinks </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <mat-chip-list>
          <mat-chip-list>
            <!-- structural links -->
            <mat-chip [routerLink]="element._links.self.href" [selected]="isPlayerOfGame(element._links)" title="about">about</mat-chip>
            <mat-chip [routerLink]="element._links.admin.href" color="primary" [selected]="isDirectorOfGame(element._links)" title="administrator of this session">director</mat-chip>
          </mat-chip-list>
        </mat-chip-list>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="actions">
      <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
      <mat-cell *matCellDef="let element">
        <!-- HATEOAS -->
        <button mat-raised-button *ngIf="element._links.join" (click)="joinSession(element._links.join.href)" [disabled]="isPlayerOfAnyGame()" [color]="!isPlayerOfAnyGame() ? 'accent' : 'default'" title="join session">join</button>
        <button mat-raised-button *ngIf="element._links.start" [disabled]="!isDirectorOfGame(element._links) || element._links.players.length < 3" (click)="closeSession(element._links.start.href)" color="accent" [title]="element._links.start.title">close</button>

        <button mat-raised-button *ngIf="element._links.turn" [disabled]="!isPlayerOfGame(element._links)" [routerLink]="element._links.turn.href" [color]="isPlayerOfGame(element._links)?'accent':'default'" [title]="element._links.turn.title">current round</button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>

</div>
